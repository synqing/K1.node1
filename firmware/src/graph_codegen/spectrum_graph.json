{
  "metadata": {
    "name": "Spectrum Pattern Graph",
    "version": "1.0.0",
    "description": "Audio-reactive spectrum visualization with 7-node DAG",
    "author": "K1.node1 Codegen",
    "timestamp": "2025-11-10"
  },
  "audio_config": {
    "sample_rate": 16000,
    "chunk_size": 128,
    "num_frequency_bins": 64,
    "frequency_range": {
      "min_hz": 50,
      "max_hz": 6400
    }
  },
  "led_config": {
    "num_leds": 180,
    "strip_layout": "center_origin"
  },
  "nodes": [
    {
      "id": "audio_input",
      "type": "AudioInput",
      "description": "Extract audio spectrum from microphone stream",
      "parameters": {
        "source": "microphone_goertzel",
        "use_smoothed": false
      },
      "outputs": ["spectrum_raw"]
    },
    {
      "id": "normalize",
      "type": "Normalize",
      "description": "Apply sensitivity gain and VU scaling",
      "parameters": {
        "sensitivity_default": 1.0,
        "vu_weighting": 0.5
      },
      "inputs": ["spectrum_raw"],
      "outputs": ["spectrum_normalized"]
    },
    {
      "id": "fft_extract",
      "type": "FFTExtract",
      "description": "Decay-based frequency bin extraction with peak tracking",
      "parameters": {
        "decay_factor": 0.85,
        "method": "peak_decay"
      },
      "inputs": ["spectrum_normalized"],
      "outputs": ["spectrum_extracted"]
    },
    {
      "id": "smoothing",
      "type": "Smoothing",
      "description": "Low-pass IIR filter for noise reduction",
      "parameters": {
        "filter_type": "lowpass_iir",
        "alpha": 0.7,
        "window_size": 1
      },
      "inputs": ["spectrum_extracted"],
      "outputs": ["spectrum_smoothed"]
    },
    {
      "id": "colorize",
      "type": "Colorize",
      "description": "Map frequency spectrum to RGB colors via HSV",
      "parameters": {
        "color_mode": "frequency_hue",
        "palette": "hot",
        "saturation": 0.95
      },
      "inputs": ["spectrum_smoothed"],
      "outputs": ["colors_led_buffer"]
    },
    {
      "id": "mirror",
      "type": "Mirror",
      "description": "Create symmetric visualization from center",
      "parameters": {
        "axis": "vertical",
        "center_index": 90
      },
      "inputs": ["colors_led_buffer"],
      "outputs": ["colors_mirrored"]
    },
    {
      "id": "led_output",
      "type": "LEDOutput",
      "description": "Final color clamping and 8-bit conversion",
      "parameters": {
        "apply_brightness": true,
        "apply_trail": true,
        "trail_decay": 0.92
      },
      "inputs": ["colors_mirrored"],
      "outputs": ["led_output"]
    }
  ],
  "connections": [
    {
      "from": "audio_input",
      "from_port": "spectrum_raw",
      "to": "normalize",
      "to_port": "spectrum_raw"
    },
    {
      "from": "normalize",
      "from_port": "spectrum_normalized",
      "to": "fft_extract",
      "to_port": "spectrum_normalized"
    },
    {
      "from": "fft_extract",
      "from_port": "spectrum_extracted",
      "to": "smoothing",
      "to_port": "spectrum_extracted"
    },
    {
      "from": "smoothing",
      "from_port": "spectrum_smoothed",
      "to": "colorize",
      "to_port": "spectrum_smoothed"
    },
    {
      "from": "colorize",
      "from_port": "colors_led_buffer",
      "to": "mirror",
      "to_port": "colors_led_buffer"
    },
    {
      "from": "mirror",
      "from_port": "colors_mirrored",
      "to": "led_output",
      "to_port": "colors_mirrored"
    }
  ],
  "stateful_nodes": [
    {
      "id": "spectrum_decay",
      "type": "BufferPersist",
      "size": 64,
      "decay_factor": 0.85,
      "used_by": "fft_extract"
    },
    {
      "id": "led_trail",
      "type": "BufferPersist",
      "size": 180,
      "decay_factor": 0.92,
      "used_by": "led_output"
    }
  ],
  "performance_targets": {
    "min_fps": 28,
    "max_frame_time_ms": 35.7,
    "audio_latency_ms": 8,
    "memory_budget_bytes": 5000
  }
}
